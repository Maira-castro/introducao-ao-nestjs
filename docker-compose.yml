services:

  postgres: # container 1 - e suas informações
    image: postgres
    container_name: postgresdb # podemos escolher qualquer nome
    environment: # variaveis do arquivo .env
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    ports:
     - "5434:5432" #o primeiro se refere a dentro do container e o segundo a que esta fora.

  api:
    build:
     context: .
     dockerfile: Dockerfile.api 
    container_name: nest-api
    env_file: .env
    ports:
      - "${API_PORT}:${API_PORT}"
         #{lado de dentro} #{lado de fora(onde vai realmente acessar apartir do pc)}
    depends_on:   #esse serviço, depende desse: 
      - postgres
    environment: #variaveis que estão no .env
       DATABASE_URL: ${DATABASE_URL_CONTAINER}
       SECRET_KEY: ${SECRET_KEY}
       CLOUDINARY_NAME_CLOUD: ${CLOUDINARY_NAME_CLOUD}
       CLOUDINARY_KEY_API: ${CLOUDINARY_KEY_API}
       CLOUDINARY_SECRET_API: ${CLOUDINARY_SECRET_API}
    command: sh -c "npx prisma migrate deploy && npm run start:prod" #comando a executar quando configurar tudo

    